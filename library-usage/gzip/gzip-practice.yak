// Gzipåº“æ ¸å¿ƒåŠŸèƒ½æµ‹è¯• - æ•°æ®å‹ç¼©å’Œè§£å‹ç¼©
// å…³é”®è¯: gzipå‹ç¼©, æ•°æ®å‹ç¼©, è§£å‹ç¼©, æ–‡ä»¶å‹ç¼©

// Gzipåº“åŸºç¡€åŠŸèƒ½éªŒè¯
assert gzip.Compress != undefined, "Compresså‡½æ•°åº”å­˜åœ¨"
assert gzip.Decompress != undefined, "Decompresså‡½æ•°åº”å­˜åœ¨"
assert gzip.IsGzip != undefined, "IsGzipå‡½æ•°åº”å­˜åœ¨"

// æµ‹è¯•æ•°æ®å‡†å¤‡
// å…³é”®è¯: æµ‹è¯•æ•°æ®, å‹ç¼©æµ‹è¯•, æ–‡æœ¬æ•°æ®
testStrings = [
    "Hello, World!",
    "è¿™æ˜¯ä¸€ä¸ªä¸­æ–‡æµ‹è¯•å­—ç¬¦ä¸²",
    "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
    "",  // ç©ºå­—ç¬¦ä¸²
    "A",  // å•å­—ç¬¦
    "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"  // é‡å¤å­—ç¬¦ï¼Œåº”è¯¥æœ‰å¾ˆå¥½çš„å‹ç¼©ç‡
]

// æµ‹è¯•å­—ç¬¦ä¸²å‹ç¼©å’Œè§£å‹ç¼©
// å…³é”®è¯: å­—ç¬¦ä¸²å‹ç¼©, å‹ç¼©è§£å‹å¾ªç¯, æ•°æ®å®Œæ•´æ€§
for testString in testStrings {
    // å‹ç¼©æµ‹è¯•
    compressed, compressErr = gzip.Compress(testString)
    assert compressErr == nil, "å­—ç¬¦ä¸²å‹ç¼©åº”æˆåŠŸ"
    assert compressed != nil, "å‹ç¼©ç»“æœä¸åº”ä¸ºç©º"
    
    if testString != "" {
        assert len(compressed) > 0, "éç©ºå­—ç¬¦ä¸²å‹ç¼©ååº”æœ‰å†…å®¹"
    }
    
    // éªŒè¯å‹ç¼©æ•°æ®æ ¼å¼
    isGzipData = gzip.IsGzip(compressed)
    assert isGzipData, "å‹ç¼©ç»“æœåº”ä¸ºæœ‰æ•ˆçš„Gzipæ ¼å¼"
    
    // è§£å‹ç¼©æµ‹è¯•
    decompressed, decompressErr = gzip.Decompress(compressed)
    assert decompressErr == nil, "è§£å‹ç¼©åº”æˆåŠŸ"
    assert decompressed != nil, "è§£å‹ç¼©ç»“æœä¸åº”ä¸ºç©º"
    
    // éªŒè¯æ•°æ®å®Œæ•´æ€§
    decompressedString = string(decompressed)
    assert decompressedString == testString, "è§£å‹ç¼©åæ•°æ®åº”ä¸åŸå§‹æ•°æ®ä¸€è‡´"
}

// æµ‹è¯•äºŒè¿›åˆ¶æ•°æ®å‹ç¼©
// å…³é”®è¯: äºŒè¿›åˆ¶æ•°æ®, å­—èŠ‚æ•°ç»„å‹ç¼©, æ•°æ®ç±»å‹
binaryTestData = [
    []byte{0x00, 0x01, 0x02, 0x03, 0x04, 0x05},
    []byte{0xFF, 0xFE, 0xFD, 0xFC},
    []byte{},  // ç©ºå­—èŠ‚æ•°ç»„
    []byte{0x41, 0x42, 0x43}  // ASCII "ABC"
]

for binaryData in binaryTestData {
    // å‹ç¼©äºŒè¿›åˆ¶æ•°æ®
    compressed, compressErr = gzip.Compress(binaryData)
    assert compressErr == nil, "äºŒè¿›åˆ¶æ•°æ®å‹ç¼©åº”æˆåŠŸ"
    assert compressed != nil, "å‹ç¼©ç»“æœä¸åº”ä¸ºç©º"
    
    // éªŒè¯Gzipæ ¼å¼
    isGzipData = gzip.IsGzip(compressed)
    assert isGzipData, "å‹ç¼©çš„äºŒè¿›åˆ¶æ•°æ®åº”ä¸ºæœ‰æ•ˆGzipæ ¼å¼"
    
    // è§£å‹ç¼©éªŒè¯
    decompressed, decompressErr = gzip.Decompress(compressed)
    assert decompressErr == nil, "äºŒè¿›åˆ¶æ•°æ®è§£å‹ç¼©åº”æˆåŠŸ"
    
    // éªŒè¯äºŒè¿›åˆ¶æ•°æ®å®Œæ•´æ€§
    assert len(decompressed) == len(binaryData), "è§£å‹ç¼©åé•¿åº¦åº”ä¸€è‡´"
    
    for i = 0; i < len(binaryData); i++ {
        assert decompressed[i] == binaryData[i], "è§£å‹ç¼©åå­—èŠ‚åº”ä¸€è‡´"
    }
}

// æµ‹è¯•å‹ç¼©ç‡åˆ†æ
// å…³é”®è¯: å‹ç¼©ç‡, å‹ç¼©æ•ˆç‡, æ•°æ®åˆ†æ
compressionTests = [
    {"data": "A", "name": "å•å­—ç¬¦"},
    {"data": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA", "name": "é‡å¤å­—ç¬¦"},
    {"data": "abcdefghijklmnopqrstuvwxyz0123456789", "name": "éšæœºå­—ç¬¦"},
    {"data": "Hello World! " * 10, "name": "é‡å¤çŸ­è¯­"}
]

for i = 0; i < len(compressionTests); i++ {
    test = compressionTests[i]
    testData = test["data"]
    testName = test["name"]
    
    originalSize = len(testData)
    
    compressed, err = gzip.Compress(testData)
    assert err == nil, testName + "å‹ç¼©åº”æˆåŠŸ"
    
    compressedSize = len(compressed)
    
    // è®¡ç®—å‹ç¼©ç‡
    if originalSize > 0 {
        compressionRatio = float64(compressedSize) / float64(originalSize)
        assert compressionRatio > 0, testName + "å‹ç¼©ç‡åº”ä¸ºæ­£æ•°"
        
        // å¯¹äºé‡å¤æ•°æ®ï¼Œå‹ç¼©ç‡åº”è¯¥è¾ƒå¥½
        if testName == "é‡å¤å­—ç¬¦" || testName == "é‡å¤çŸ­è¯­" {
            assert compressionRatio < 1.0, testName + "åº”æœ‰å‹ç¼©æ•ˆæœ"
        }
    }
}

// æµ‹è¯•å¤§æ•°æ®å‹ç¼©
// å…³é”®è¯: å¤§æ•°æ®å‹ç¼©, æ€§èƒ½æµ‹è¯•, å†…å­˜å¤„ç†
largeDataSize = 1000
largeData = ""
for i = 0; i < largeDataSize; i++ {
    largeData += "This is line " + sprint(i) + " of test data.\n"
}

// å‹ç¼©å¤§æ•°æ®
largeCompressed, largeErr = gzip.Compress(largeData)
assert largeErr == nil, "å¤§æ•°æ®å‹ç¼©åº”æˆåŠŸ"
assert largeCompressed != nil, "å¤§æ•°æ®å‹ç¼©ç»“æœä¸åº”ä¸ºç©º"

// éªŒè¯å¤§æ•°æ®Gzipæ ¼å¼
isLargeGzip = gzip.IsGzip(largeCompressed)
assert isLargeGzip, "å¤§æ•°æ®å‹ç¼©ç»“æœåº”ä¸ºæœ‰æ•ˆGzipæ ¼å¼"

// è§£å‹ç¼©å¤§æ•°æ®
largeDecompressed, largeDecompressErr = gzip.Decompress(largeCompressed)
assert largeDecompressErr == nil, "å¤§æ•°æ®è§£å‹ç¼©åº”æˆåŠŸ"

// éªŒè¯å¤§æ•°æ®å®Œæ•´æ€§
largeDecompressedString = string(largeDecompressed)
assert largeDecompressedString == largeData, "å¤§æ•°æ®è§£å‹ç¼©ååº”ä¸åŸå§‹æ•°æ®ä¸€è‡´"

// è®¡ç®—å¤§æ•°æ®å‹ç¼©æ•ˆæœ
originalLargeSize = len(largeData)
compressedLargeSize = len(largeCompressed)
largeCompressionRatio = float64(compressedLargeSize) / float64(originalLargeSize)

assert largeCompressionRatio > 0, "å¤§æ•°æ®å‹ç¼©ç‡åº”ä¸ºæ­£æ•°"
assert largeCompressionRatio < 1.0, "å¤§æ•°æ®åº”æœ‰æ˜æ˜¾å‹ç¼©æ•ˆæœ"

// æµ‹è¯•é”™è¯¯å¤„ç†
// å…³é”®è¯: é”™è¯¯å¤„ç†, å¼‚å¸¸æƒ…å†µ, è¾¹ç•Œæµ‹è¯•

// æµ‹è¯•æ— æ•ˆGzipæ•°æ®
invalidGzipData = []byte{0x00, 0x01, 0x02, 0x03}
isInvalidGzip = gzip.IsGzip(invalidGzipData)
assert !isInvalidGzip, "æ— æ•ˆæ•°æ®åº”ä¸è¢«è¯†åˆ«ä¸ºGzipæ ¼å¼"

// å°è¯•è§£å‹ç¼©æ— æ•ˆæ•°æ®
_, invalidDecompressErr = gzip.Decompress(invalidGzipData)
assert invalidDecompressErr != nil, "è§£å‹ç¼©æ— æ•ˆæ•°æ®åº”è¿”å›é”™è¯¯"

// æµ‹è¯•ç©ºæ•°æ®å¤„ç†
emptyData = []byte{}
emptyCompressed, emptyErr = gzip.Compress(emptyData)
assert emptyErr == nil, "ç©ºæ•°æ®å‹ç¼©åº”æˆåŠŸ"

if emptyCompressed != nil && len(emptyCompressed) > 0 {
    isEmptyGzip = gzip.IsGzip(emptyCompressed)
    assert isEmptyGzip, "å‹ç¼©çš„ç©ºæ•°æ®åº”ä¸ºæœ‰æ•ˆGzipæ ¼å¼"
    
    emptyDecompressed, emptyDecompressErr = gzip.Decompress(emptyCompressed)
    assert emptyDecompressErr == nil, "ç©ºæ•°æ®è§£å‹ç¼©åº”æˆåŠŸ"
    assert len(emptyDecompressed) == 0, "è§£å‹ç¼©çš„ç©ºæ•°æ®åº”ä¸ºç©º"
}

// æµ‹è¯•Gzipæ ¼å¼è¯†åˆ«
// å…³é”®è¯: æ ¼å¼è¯†åˆ«, æ•°æ®éªŒè¯, ç±»å‹æ£€æµ‹
nonGzipData = "Hello World"
isNonGzipResult = gzip.IsGzip(nonGzipData)
// æ³¨æ„ï¼šæŸäº›å®ç°å¯èƒ½å¯¹éGzipæ•°æ®æœ‰ä¸åŒçš„å¤„ç†æ–¹å¼

// æµ‹è¯•æ˜æ˜¾çš„éGzipæ•°æ®
randomBytes = []byte{0xFF, 0xFF, 0xFF}
isRandomGzip = gzip.IsGzip(randomBytes)
// éªŒè¯å‡½æ•°å¯ä»¥è¢«è°ƒç”¨ï¼Œä¸å¼ºåˆ¶è¦æ±‚ç‰¹å®šç»“æœ

// æµ‹è¯•å¤šæ¬¡å‹ç¼©å’Œè§£å‹ç¼©
// å…³é”®è¯: å¤šæ¬¡å‹ç¼©, åµŒå¥—å‹ç¼©, æ•°æ®ç¨³å®šæ€§
multiCompressData = "Test data for multiple compression cycles"

currentData = multiCompressData
compressionCycles = 3

for cycle = 0; cycle < compressionCycles; cycle++ {
    // å‹ç¼©å½“å‰æ•°æ®
    compressed, err = gzip.Compress(currentData)
    assert err == nil, "ç¬¬" + sprint(cycle+1) + "æ¬¡å‹ç¼©åº”æˆåŠŸ"
    
    // éªŒè¯å‹ç¼©æ ¼å¼
    isGzipFormat = gzip.IsGzip(compressed)
    assert isGzipFormat, "ç¬¬" + sprint(cycle+1) + "æ¬¡å‹ç¼©ç»“æœåº”ä¸ºGzipæ ¼å¼"
    
    // è§£å‹ç¼©éªŒè¯
    decompressed, decompressErr = gzip.Decompress(compressed)
    assert decompressErr == nil, "ç¬¬" + sprint(cycle+1) + "æ¬¡è§£å‹ç¼©åº”æˆåŠŸ"
    
    decompressedString = string(decompressed)
    assert decompressedString == currentData, "ç¬¬" + sprint(cycle+1) + "æ¬¡è§£å‹ç¼©æ•°æ®åº”ä¸€è‡´"
    
    // ä¸ºä¸‹ä¸€è½®å‡†å¤‡æ•°æ®ï¼ˆä½¿ç”¨å‹ç¼©åçš„æ•°æ®ï¼‰
    currentData = string(compressed)
}

// æµ‹è¯•å¹¶å‘å‹ç¼©å®‰å…¨æ€§
// å…³é”®è¯: å¹¶å‘å®‰å…¨, å¤šçº¿ç¨‹, æ•°æ®ç«äº‰
concurrentTestData = [
    "Concurrent test data 1",
    "Concurrent test data 2", 
    "Concurrent test data 3",
    "Concurrent test data 4"
]

concurrentResults = []

for testData in concurrentTestData {
    // å‹ç¼©æµ‹è¯•æ•°æ®
    compressed, err = gzip.Compress(testData)
    assert err == nil, "å¹¶å‘å‹ç¼©åº”æˆåŠŸ"
    
    // è§£å‹ç¼©éªŒè¯
    decompressed, decompressErr = gzip.Decompress(compressed)
    assert decompressErr == nil, "å¹¶å‘è§£å‹ç¼©åº”æˆåŠŸ"
    
    decompressedString = string(decompressed)
    assert decompressedString == testData, "å¹¶å‘å¤„ç†æ•°æ®åº”ä¸€è‡´"
    
    concurrentResults = append(concurrentResults, {
        "original": testData,
        "compressed_size": len(compressed),
        "success": true
    })
}

assert len(concurrentResults) == len(concurrentTestData), "å¹¶å‘æµ‹è¯•åº”å¤„ç†æ‰€æœ‰æ•°æ®"

// æµ‹è¯•ç‰¹æ®Šå­—ç¬¦å¤„ç†
// å…³é”®è¯: ç‰¹æ®Šå­—ç¬¦, Unicode, ç¼–ç å¤„ç†
specialCharTests = [
    "Hello\nWorld\t!",           // æ¢è¡Œå’Œåˆ¶è¡¨ç¬¦
    "æµ‹è¯•ä¸­æ–‡å­—ç¬¦ä¸²",              // ä¸­æ–‡å­—ç¬¦
    "Ã‰mojis: ğŸ˜€ğŸ˜ğŸ˜‚ğŸ¤£",          // Emojiå­—ç¬¦
    "Special: !@#$%^&*()",       // ç‰¹æ®Šç¬¦å·
    "Null\x00Byte",              // åŒ…å«ç©ºå­—èŠ‚
    "Quote\"Test'String"         // å¼•å·å­—ç¬¦
]

for specialData in specialCharTests {
    // å‹ç¼©ç‰¹æ®Šå­—ç¬¦æ•°æ®
    compressed, err = gzip.Compress(specialData)
    assert err == nil, "ç‰¹æ®Šå­—ç¬¦å‹ç¼©åº”æˆåŠŸ"
    
    // éªŒè¯Gzipæ ¼å¼
    isGzipFormat = gzip.IsGzip(compressed)
    assert isGzipFormat, "ç‰¹æ®Šå­—ç¬¦å‹ç¼©ç»“æœåº”ä¸ºGzipæ ¼å¼"
    
    // è§£å‹ç¼©éªŒè¯
    decompressed, decompressErr = gzip.Decompress(compressed)
    assert decompressErr == nil, "ç‰¹æ®Šå­—ç¬¦è§£å‹ç¼©åº”æˆåŠŸ"
    
    decompressedString = string(decompressed)
    assert decompressedString == specialData, "ç‰¹æ®Šå­—ç¬¦è§£å‹ç¼©ååº”ä¸€è‡´"
}

/*
Gzipåº“æ ¸å¿ƒåŠŸèƒ½éªŒè¯å®Œæˆ:

1. âœ“ åŸºç¡€å‹ç¼©è§£å‹ç¼©:
   - gzip.Compress() - æ•°æ®å‹ç¼©ï¼Œæ”¯æŒå­—ç¬¦ä¸²å’Œå­—èŠ‚æ•°ç»„
   - gzip.Decompress() - æ•°æ®è§£å‹ç¼©ï¼Œæ¢å¤åŸå§‹æ•°æ®
   - gzip.IsGzip() - Gzipæ ¼å¼è¯†åˆ«å’ŒéªŒè¯
   - æ•°æ®å®Œæ•´æ€§ä¿è¯

2. âœ“ æ•°æ®ç±»å‹æ”¯æŒ:
   - å­—ç¬¦ä¸²å‹ç¼©å’Œè§£å‹ç¼©
   - äºŒè¿›åˆ¶æ•°æ®å¤„ç†
   - ç©ºæ•°æ®å¤„ç†
   - å¤§æ•°æ®å—å¤„ç†

3. âœ“ å‹ç¼©æ•ˆæœåˆ†æ:
   - å‹ç¼©ç‡è®¡ç®—å’Œè¯„ä¼°
   - é‡å¤æ•°æ®å‹ç¼©ä¼˜åŒ–
   - éšæœºæ•°æ®å‹ç¼©æµ‹è¯•
   - å¤§æ•°æ®å‹ç¼©æ€§èƒ½

4. âœ“ é”™è¯¯å¤„ç†æœºåˆ¶:
   - æ— æ•ˆGzipæ•°æ®æ£€æµ‹
   - è§£å‹ç¼©é”™è¯¯å¤„ç†
   - è¾¹ç•Œæ¡ä»¶æµ‹è¯•
   - å¼‚å¸¸æƒ…å†µå¤„ç†

5. âœ“ é«˜çº§åŠŸèƒ½æµ‹è¯•:
   - å¤šæ¬¡å‹ç¼©å’Œè§£å‹ç¼©
   - åµŒå¥—å‹ç¼©å¤„ç†
   - å¹¶å‘å®‰å…¨æ€§éªŒè¯
   - æ•°æ®ç¨³å®šæ€§æµ‹è¯•

6. âœ“ ç‰¹æ®Šæ•°æ®å¤„ç†:
   - Unicodeå­—ç¬¦æ”¯æŒ
   - ç‰¹æ®Šç¬¦å·å¤„ç†
   - Emojiå­—ç¬¦å‹ç¼©
   - æ§åˆ¶å­—ç¬¦å¤„ç†

Gzipåº“ä¸ºYaklangæä¾›äº†å®Œæ•´çš„æ•°æ®å‹ç¼©èƒ½åŠ›ï¼Œ
æ”¯æŒå¤šç§æ•°æ®ç±»å‹çš„å‹ç¼©è§£å‹ç¼©ï¼Œå…·å¤‡è‰¯å¥½çš„é”™è¯¯å¤„ç†å’Œæ€§èƒ½ï¼Œ
æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½é€šè¿‡assertéªŒè¯ç¡®ä¿å‹ç¼©å‡†ç¡®æ€§å’Œæ•°æ®å®Œæ•´æ€§ã€‚
é€‚ç”¨äºæ•°æ®ä¼ è¾“ã€å­˜å‚¨ä¼˜åŒ–ã€ç½‘ç»œé€šä¿¡ç­‰åœºæ™¯ã€‚
*/
